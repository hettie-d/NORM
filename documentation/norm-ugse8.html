<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Modifications</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<!-- html,2,sections+ --> 
<meta name="src" content="norm-ug.tex"> 
<link rel="stylesheet" type="text/css" href="norm-ug.css"> 
</head><body 
>
   <!--l. 447--><div class="crosslinks"><p class="noindent">[<a 
href="norm-ugse9.html" >next</a>] [<a 
href="norm-ugse7.html" >prev</a>] [<a 
href="norm-ugse7.html#tailnorm-ugse7.html" >prev-tail</a>] [<a 
href="#tailnorm-ugse8.html">tail</a>] [<a 
href="norm-ug.html#norm-ugse8.html" >up</a>] </p></div>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
href="norm-ug.html#QQ2-9-17" id="x9-140008">Modifications</a></h3>
<!--l. 449--><p class="noindent" >NORM provides means for automatic modification under the assumption that
all base tables of the objects in the hierarchy have automatically assigned
surrogate primary keys (selected from a database sequence or produced by a
trigger).
<!--l. 451--><p class="indent" >   An application forms an update request as an array of JSON hierarchies. The
structure of these hierarchies follows the JSON schema with some additions. The
following rules guide the interpretation of an update request:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 454--><p class="noindent" >If an object at any level of the hierarchy contains an attribute&#8217;s value
     mapped to the base table&#8217;s primary key, this object is updated with values
     of other attributes specified in the request. Only attributes mapped to an
     object&#8217;s base table may be updated.
     </li>
     <li class="itemize">
     <!--l. 456--><p class="noindent" >If an object contains a value of attribute mapped to the primary key and
     additional key &#8221;cmd&#8221; (probably should be &#8221;<span 
class="tcrm-1000">$</span>cmd&#8217;) with value &#8221;DELETE&#8221;
     then this object and all its descendants are deleted from the database.
     </li>
     <li class="itemize">
     <!--l. 457--><p class="noindent" >If an object does not contain a value mapped to the primary key, then all
     its descendants should not contain values for primary keys, and the object
     is inserted together with its descendants. New surrogate values of primary
     keys are assigned to inserted objects.</li></ul>
<!--l. 460--><p class="indent" >   An example of an update request is shown below:

   <pre class="verbatim" id="verbatim-16">
&#x00A0;[
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_id":&#x00A0;556470,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"cmd":&#x00A0;"DELETE"
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;},
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"passengers":&#x00A0;[
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"last_name":&#x00A0;"Jones",
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"account_id":&#x00A0;238648,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"first_name":&#x00A0;"Lucy"
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;],
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_legs":&#x00A0;[
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"leg_num":&#x00A0;1,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"flight_id":&#x00A0;558238,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;},
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"leg_num":&#x00A0;2,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"flight_id":&#x00A0;563410
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;],
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_reference":&#x00A0;"IYZI42"
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;},
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_id":&#x00A0;3974917,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"passengers":&#x00A0;[
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"cmd":&#x00A0;"DELETE",
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"passenger_id":&#x00A0;11479596
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;},
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"last_name":&#x00A0;"SCOTT",
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"first_name":&#x00A0;"MILES",
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"passenger_id":&#x00A0;11479599
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;],
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_legs":&#x00A0;[
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"flight_id":&#x00A0;432724,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_leg_id":&#x00A0;11453272

&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;},
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"flight_id":&#x00A0;427273,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_leg_id":&#x00A0;11453273
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;]
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;},
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_id":&#x00A0;2733047,
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"booking_reference":&#x00A0;"Q8JX22"
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;]
</pre>
<!--l. 516--><p class="nopar" >
<!--l. 518--><p class="indent" >   All modifications are performed with bulk operations. For any update request,
NORM executes at most one DELEtE, one UPDATE, and two INSERT SQL
statements from each object type in the JSON schema, no matter how many
instances of the objects are included in the update request.
<!--l. 520--><p class="indent" >   The following function generates several PostgreSQL types and functions needed
to perform modifications of hierarchies defined in a JSON schema:

   <pre class="verbatim" id="verbatim-17">
norm_gen.build_to_db&#x00A0;(p_hierarchy&#x00A0;text)&#x00A0;returns&#x00A0;text
</pre>
<!--l. 523--><p class="nopar" >
<!--l. 525--><p class="indent" >   Finally, NORM provides a high-level function that executes the script generated
by <span 
class="cmtt-10">build</span><span 
class="cmtt-10">_to</span><span 
class="cmtt-10">_db</span>:

   <pre class="verbatim" id="verbatim-18">
norm_gen.generate_to_db_function(
&#x00A0;&#x00A0;p_schema_name&#x00A0;text)
returns&#x00A0;boolean
</pre>
<!--l. 531--><p class="nopar" >

   <!--l. 533--><div class="crosslinks"><p class="noindent">[<a 
href="norm-ugse9.html" >next</a>] [<a 
href="norm-ugse7.html" >prev</a>] [<a 
href="norm-ugse7.html#tailnorm-ugse7.html" >prev-tail</a>] [<a 
href="norm-ugse8.html" >front</a>] [<a 
href="norm-ug.html#norm-ugse8.html" >up</a>] </p></div>
<!--l. 533--><p class="indent" >   <a 
 id="tailnorm-ugse8.html"></a>  
</body></html> 
